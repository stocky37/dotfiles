#!/bin/bash

export OLD_EMAIL=$(git config --global --includes user.email)
export NAME="$(git config user.name)"
export EMAIL="$(git config user.email)"

echo "Old: * <$OLD_EMAIL>"
echo "New: $NAME <$EMAIL>"
echo "To undo, use: git reset $(git rev-parse HEAD)"

git filter-branch --env-filter \
'
echo "$GIT_COMMITTER_EMAIL"
if [ "$GIT_COMMITTER_EMAIL" = "$OLD_EMAIL" ]
then
    export GIT_COMMITTER_NAME="$NAME"
    export GIT_COMMITTER_EMAIL="$EMAIL"
fi
if [ "$GIT_AUTHOR_EMAIL" = "$OLD_EMAIL" ]
then
    export GIT_AUTHOR_NAME="$NAME"
    export GIT_AUTHOR_EMAIL="$EMAIL"
fi
' "$@"  # -- HEAD~2..HEAD
